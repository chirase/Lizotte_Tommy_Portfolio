"use strict";var Blitz=Blitz||{};Blitz.Jeu=function(){};Blitz.Jeu.prototype={init:function(){this.leJoueur=null;this.estMort=!1;this.vitesseJeu=1;this.chemin1=null;this.chemin2=null;this.ennemis=null;this.intervalleEnnemi=0;this.intervalle=null;this.epee=null;this.AnimAttaque=null;this.peutAttaquer=!1;this.attaquer=!1;Blitz.score=0;Blitz.temps=0;this.stage.backgroundColor="#14530f";this.lesVies=[];this.vie=3;this.pointage=null;this.pointageImage=null;this.tempsChrono=0;this.herbes=[]},create:function(){Blitz.musique.stop()
Blitz.musique=this.add.audio("sonJeu",1).loopFull();this.input.MAX_POINTERS=1;var leFond=this.add.image(this.game.width/2,this.game.height/2,'fondJeu');leFond.anchor.set(0.5);this.chemin1=this.add.sprite(this.game.width/2,this.game.height,'pisteJeu');this.chemin2=this.add.sprite(this.game.width/2,this.chemin1.y-this.chemin1.height,'pisteJeu');this.chemin2.anchor.set(0.5);this.chemin1.anchor.set(0.5);this.leJoueur=this.add.sprite(this.game.width/2,this.game.height,'hero');this.leJoueur.anchor.set(0.5);this.leJoueur.y=this.game.height+this.leJoueur.height/2;var entrerJoueur=this.add.tween(this.leJoueur).to({y:this.game.height-this.leJoueur.height},2000,Phaser.Easing.Linear.None,!0,0);entrerJoueur.onComplete.add(this.demarrage,this);this.leJoueur.animations.add("marche",[0,1],3,!0);this.leJoueur.animations.play("marche");this.physics.enable(this.leJoueur,Phaser.Physics.ARCADE);this.leJoueur.body.width=this.leJoueur.width/1.5;this.leJoueur.body.offset.x=this.leJoueur.width/5;this.leJoueur.body.offset.y=this.leJoueur.height/15;this.ennemis=this.add.physicsGroup(Phaser.Physics.ARCADE);this.toucheEspace=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},demarrage:function(objCible){this.leJoueur.animations._anims.marche.speed=5;this.vitesseJeu=10;this.intervalleEnnemi=1;this.intervalle=this.time.events.loop(Phaser.Timer.SECOND,this.decrementeTimer,this);this.epee=this.add.sprite(this.leJoueur.x,this.leJoueur.y-(this.leJoueur.height/2.5),'epee');this.epee.anchor.set(0.5,1);this.epee.scale={x:1.5,y:1.5};this.AnimAttaque=this.add.tween(this.epee).to({angle:90},300,Phaser.Easing.Linear.None,!1,0);this.AnimAttaque.onComplete.add(this.prochaineAttaque,this);this.epee.alpha=0;this.peutAttaquer=!0;this.physics.enable(this.epee,Phaser.Physics.ARCADE);for(var i=0;i<3;i++){var uneVie,posX,posY;switch(i){case 0:posX=this.game.width/2;posY=this.game.height;break;case 1:posX=this.lesVies[0].x-this.lesVies[0].width;posY=this.game.height;break;case 2:posX=this.lesVies[0].x+this.lesVies[0].width;posY=this.game.height;break}
uneVie=this.add.image(posX,posY,'vie');uneVie.anchor.set(0.5,1);this.lesVies.push(uneVie)}
var style1={font:"bold 45px Arial",fill:"#FFFFFF",align:"center"};this.pointage=this.add.text(this.game.width/7,this.game.height/100,Blitz.score,style1);this.pointage.anchor.set(0.5,0);this.pointageImage=this.add.image(this.game.width/20,this.pointage.y-this.game.height/100,'iconeOr');this.pointageImage.anchor.set(0.5,0);this.pointageImage.scale={x:0.7,y:0.7};var style2={font:"bold 30px Arial",fill:"#FFFFFF",align:"center"};this.tempsChrono=this.add.text(this.game.width/2,0,Blitz.temps,style2);this.tempsChrono.anchor.set(0.5,0);this.world.bringToTop(this.pointage);this.time.events.loop(Phaser.Timer.SECOND/5,this.apparitionHerbe,this)},apparitionHerbe:function(){var asNoms=["herbe"+this.rnd.integerInRange(1,3),"roche","fleur"];var iObjAleatoire=this.rnd.integerInRange(0,2);var herbe=this.add.image(this.rnd.integerInRange(0,this.game.width),-Blitz.TAILLE_HERBE,asNoms[iObjAleatoire]);herbe.anchor.set(0.5);if(herbe.x>(this.game.width/2-this.chemin1.width/2)&&herbe.x<(this.game.width/2+this.chemin1.width/2)){herbe.x=(herbe.x>this.game.width/2-this.chemin1.width/2)?this.rnd.integerInRange(0,this.game.width/2-this.chemin1.width/2):this.rnd.integerInRange(this.game.width/2+this.chemin1.width/2,this.game.width)}
var herbeAnim=this.add.tween(herbe).to({y:this.game.height+Blitz.TAILLE_HERBE},15000/this.vitesseJeu,Phaser.Easing.Linear.None,!0,0);herbe.scale={x:2,y:2}},prochaineAttaque:function(){this.epee.alpha=0;this.attaquer=!1;this.time.events.add(Phaser.Timer.SECOND*0.8,()=>{this.peutAttaquer=!0})},decrementeTimer:function(){Blitz.temps++;this.tempsChrono.text=Blitz.temps;if(this.intervalleEnnemi>0){this.intervalleEnnemi--}else{this.creerEnnemi()}},creerEnnemi:function(){this.intervalleEnnemi=this.rnd.integerInRange(0,2);var ennemi=this.ennemis.create(this.rnd.integerInRange(0,this.game.width),-this.game.height/10,'ennemi');ennemi.animations.add("marche",[0,1],3,!0);ennemi.animations.play("marche");ennemi.anchor.set(0.5);var ennemiSurJoueur=this.add.tween(ennemi).to({y:this.leJoueur.y,x:this.leJoueur.x,},500*this.vitesseJeu,Phaser.Easing.Linear.None,!0,0);this.world.bringToTop(this.leJoueur)},update:function(){if(this.estMort){this.epee.alpha=0}
if(this.peutAttaquer){if(this.toucheEspace.isDown||this.input.pointer1.isDown){this.sonCoupAleatoire();this.epee.alpha=1;this.attaquer=!0;this.peutAttaquer=!1;this.epee.angle=-90;this.AnimAttaque.start()}}
this.physics.arcade.overlap(this.leJoueur,this.ennemis,this.recevoirDegat,null,this);if(this.attaquer&&!this.peutAttaquer&&!this.estMort){this.physics.arcade.overlap(this.epee,this.ennemis,this.mortEnnemie,null,this)}
this.chemin1.y+=this.vitesseJeu;this.chemin2.y+=this.vitesseJeu;if(this.chemin1.y>this.game.height+(this.chemin2.height/2)){this.chemin1.y=this.chemin2.y-this.chemin2.height}
if(this.chemin2.y>this.game.height+(this.chemin2.height/2)){this.chemin2.y=this.chemin1.y-this.chemin1.height}},mortEnnemie:function(obj,ennemi){this.add.audio("mort",1).play();ennemi.body.enable=!1;var mortEnnemieTween=this.add.tween(ennemi).to({alpha:0,tint:"red"},300,Phaser.Easing.Linear.None,!0,0);mortEnnemieTween.onComplete.add(()=>{ennemi.destroy(),Blitz.score+=5
this.pointage.text=Blitz.score})},sonCoupAleatoire:function(){var iAleatoire=this.rnd.integerInRange(1,3);this.add.audio("coup"+iAleatoire,1).play()},recevoirDegat:function(obj,ennemi){if(this.estMort==!1){this.add.audio("mort",1).play();this.mortEnnemie(obj,ennemi);this.vie--;this.vieTeinteInitiale=this.lesVies[0].tint;for(var i=0;i<=2;i++){this.lesVies[i].tint="red"}
for(var i=0;i<this.vie;i++){switch(i){case 0:this.lesVies[1].tint=this.vieTeinteInitiale;break;case 1:this.lesVies[0].tint=this.vieTeinteInitiale;this.lesVies[1].tint=this.vieTeinteInitiale;break;case 2:this.lesVies[0].tint=this.vieTeinteInitiale;this.lesVies[1].tint=this.vieTeinteInitiale;this.lesVies[2].tint=this.vieTeinteInitiale;break}}
if(this.vie<=0){this.mort(obj)}}},mort:function(obj){if(this.estMort==!1){this.estMort=!0;Blitz.musique.stop()
var fantome=this.add.sprite(this.leJoueur.x,this.leJoueur.y,'heroIdle');fantome.anchor.set(0.5);var tweenFantome=this.add.tween(fantome).to({y:fantome.y-fantome.height,alpha:0},2000,Phaser.Easing.Linear.None,!0,0);tweenFantome.onComplete.add(this.allerFinJeu,this);this.leJoueur.alpha=0;this.vitesseJeu=0;this.intervalleEnnemi=1000}},allerFinJeu:function(){this.state.start("FinJeu")}}